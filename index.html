<!DOCTYPE html>
<html lang="uk">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Game API Test Interface</title>
		<link
			href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap"
			rel="stylesheet"
		/>
		<style>
			body {
				font-family: 'Roboto', sans-serif;
				background: #f4f6fb;
				margin: 0;
				padding: 0;
			}
			.container {
				max-width: 500px;
				margin: 40px auto;
				background: #fff;
				border-radius: 12px;
				box-shadow: 0 2px 16px rgba(0, 0, 0, 0.08);
				padding: 32px 24px 24px 24px;
			}
			h2 {
				text-align: center;
				color: #2d3a4b;
				margin-bottom: 24px;
			}
			label {
				display: block;
				margin-top: 16px;
				color: #2d3a4b;
				font-weight: 700;
			}
			input[type='text'],
			input[type='number'] {
				width: 100%;
				padding: 8px 10px;
				margin-top: 6px;
				border: 1px solid #cfd8dc;
				border-radius: 6px;
				font-size: 16px;
			}
			.drone-row {
				display: flex;
				gap: 8px;
			}
			.drone-row input {
				flex: 1;
			}
			button {
				margin-top: 20px;
				width: 100%;
				padding: 12px;
				background: #1976d2;
				color: #fff;
				border: none;
				border-radius: 6px;
				font-size: 16px;
				font-weight: 700;
				cursor: pointer;
				transition: background 0.2s;
			}
			button:hover {
				background: #125ea7;
			}
			.result {
				margin-top: 24px;
				background: #e3f2fd;
				border-radius: 6px;
				padding: 16px;
				color: #1a237e;
				font-size: 15px;
				word-break: break-all;
			}
			.section {
				margin-bottom: 32px;
			}
			.result-item {
				border: 1px solid #ccc;
				padding: 10px;
				margin: 10px 0;
				border-radius: 5px;
			}
			.result-item h3 {
				margin-top: 0;
				color: #333;
			}
			.result-item ul {
				list-style-type: none;
				padding-left: 0;
			}
			.result-item li {
				margin: 5px 0;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h2>Game API Test Interface</h2>
			<div class="section">
				<label for="username">–Ü–º'—è –≥—Ä–∞–≤—Ü—è</label>
				<input type="text" id="username" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è..." />
				<label for="gameId">ID –≥—Ä–∏ (–∑–∞–ª–∏—à—Ç–µ –ø—É—Å—Ç–∏–º –¥–ª—è –Ω–æ–≤–æ—ó –≥—Ä–∏)</label>
				<input type="text" id="gameId" placeholder="–í–≤–µ–¥—ñ—Ç—å ID –≥—Ä–∏..." />
				<button onclick="registerPlayer()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
			</div>
			<div class="section">
				<button onclick="startGame()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –≥—Ä–∏</button>
			</div>
			<div class="section">
				<label>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥—Ä–æ–Ω—ñ–≤ (—Å—É–º–∞ = 1000, —Å–ø–∞–¥–∞–Ω–Ω—è):</label>
				<div class="drone-row">
					<input type="number" id="kronus" placeholder="Kronus" value="200" />
					<input type="number" id="lyrion" placeholder="Lyrion" value="200" />
					<input type="number" id="mystara" placeholder="Mystara" value="200" />
					<input
						type="number"
						id="eclipsia"
						placeholder="Eclipsia"
						value="200"
					/>
					<input type="number" id="fiora" placeholder="Fiora" value="200" />
				</div>
				<button onclick="submitMove()">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ö—ñ–¥</button>
			</div>
			<div class="section">
				<button onclick="getResults()">–û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</button>
			</div>
			<div class="section">
				<button onclick="disconnect()" style="background: #dc3545">
					–í—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è
				</button>
			</div>
			<div class="section">
				<button onclick="cleanup()" style="background: #6c757d">
					–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è
				</button>
			</div>
			<div class="result" id="result"></div>
			<div id="results" style="display: none">
				<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–∞—É–Ω–¥—É</h2>
				<div id="roundResults"></div>
				<button onclick="submitMove()">–ó—Ä–æ–±–∏—Ç–∏ —Ö—ñ–¥</button>
			</div>
		</div>
		<script>
			let player_id = null
			let game_id = null
			const BASE_URL = '/GameDev/'

			function showResult(data) {
				document.getElementById('result').textContent =
					typeof data === 'string' ? data : JSON.stringify(data, null, 2)
			}

			function registerPlayer() {
				const username = document.getElementById('username').value.trim()
				const gameId = document.getElementById('gameId').value.trim()

				if (!username) {
					showResult("–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –≥—Ä–∞–≤—Ü—è!")
					return
				}

				const endpoint = gameId ? 'join_game.php' : 'register.php'
				const data = gameId ? { username, game_id: gameId } : { username }

				fetch(BASE_URL + endpoint, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(data),
				})
					.then(r => r.json())
					.then(data => {
						if (data.success) {
							player_id = data.player_id
							game_id = data.game_id
							showResult(
								'–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞!\nplayer_id: ' +
									player_id +
									'\ngame_id: ' +
									game_id
							)
						} else {
							showResult(data.message || '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó')
						}
					})
					.catch(e => showResult('–ü–æ–º–∏–ª–∫–∞: ' + e))
			}

			function startGame() {
				if (!player_id) {
					showResult('–°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å!')
					return
				}
				fetch(BASE_URL + 'start_game.php?player_id=' + player_id)
					.then(r => r.json())
					.then(data => {
						if (data.success) {
							showResult(data)
						} else {
							showResult(data.message || '–ü–æ–º–∏–ª–∫–∞ —Å—Ç–∞—Ä—Ç—É –≥—Ä–∏')
						}
					})
					.catch(e => showResult('–ü–æ–º–∏–ª–∫–∞: ' + e))
			}

			function showResults(results) {
				const resultsDiv = document.getElementById('roundResults')
				resultsDiv.innerHTML = ''

				// –°–æ—Ä—Ç—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–∞ –±–∞–ª–∞–º–∏ (–≤—ñ–¥ –±—ñ–ª—å—à–æ–≥–æ –¥–æ –º–µ–Ω—à–æ–≥–æ)
				results.sort((a, b) => b.score - a.score)

				results.forEach((result, index) => {
					const resultElement = document.createElement('div')
					resultElement.className = 'result-item'
					resultElement.innerHTML = `
						<h3>${result.is_winner ? 'üèÜ ' : ''}${result.username}</h3>
						<p>–ë–∞–ª–∏: ${result.score}</p>
						<p>–î—Ä–æ–Ω–∏:</p>
						<ul>
							<li>Kronus: ${result.drones.kronus}</li>
							<li>Lyrion: ${result.drones.lyrion}</li>
							<li>Mystara: ${result.drones.mystara}</li>
							<li>Eclipsia: ${result.drones.eclipsia}</li>
							<li>Fiora: ${result.drones.fiora}</li>
						</ul>
					`
					resultsDiv.appendChild(resultElement)
				})

				document.getElementById('game').style.display = 'none'
				document.getElementById('results').style.display = 'block'
			}

			function submitMove() {
				if (!player_id || !game_id) {
					showResult('–°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å!')
					return
				}
				const kronus = parseInt(document.getElementById('kronus').value, 10)
				const lyrion = parseInt(document.getElementById('lyrion').value, 10)
				const mystara = parseInt(document.getElementById('mystara').value, 10)
				const eclipsia = parseInt(document.getElementById('eclipsia').value, 10)
				const fiora = parseInt(document.getElementById('fiora').value, 10)
				const total = kronus + lyrion + mystara + eclipsia + fiora
				if (total !== 1000) {
					showResult('–°—É–º–∞ –¥—Ä–æ–Ω—ñ–≤ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ 1000!')
					return
				}
				if (
					!(
						kronus >= lyrion &&
						lyrion >= mystara &&
						mystara >= eclipsia &&
						eclipsia >= fiora
					)
				) {
					showResult('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥—Ä–æ–Ω—ñ–≤ –º–∞—î –±—É—Ç–∏ —É –ø–æ—Ä—è–¥–∫—É —Å–ø–∞–¥–∞–Ω–Ω—è!')
					return
				}
				fetch(BASE_URL + 'submit_move.php', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({
						player_id,
						game_id,
						kronus,
						lyrion,
						mystara,
						eclipsia,
						fiora,
					}),
				})
					.then(r => r.json())
					.then(data => {
						if (data.success) {
							showResult('–•—ñ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!')
							document.getElementById('results').style.display = 'none'
							document.getElementById('game').style.display = 'block'
							// –û—á–∏—â–∞—î–º–æ –ø–æ–ª—è –≤–≤–æ–¥—É
							document.getElementById('kronus').value = ''
							document.getElementById('lyrion').value = ''
							document.getElementById('mystara').value = ''
							document.getElementById('eclipsia').value = ''
							document.getElementById('fiora').value = ''
						} else {
							showResult(data.message || '–ü–æ–º–∏–ª–∫–∞ —Ö–æ–¥—É')
						}
					})
					.catch(e => showResult('–ü–æ–º–∏–ª–∫–∞: ' + e))
			}

			function getResults() {
				if (!game_id) {
					showResult('–°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å!')
					return
				}
				fetch(BASE_URL + 'get_results.php?game_id=' + game_id)
					.then(r => r.json())
					.then(data => {
						if (data.success) {
							showResult(data.results)
						} else {
							showResult(data.message || '–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤')
						}
					})
					.catch(e => showResult('–ü–æ–º–∏–ª–∫–∞: ' + e))
			}

			function disconnect() {
				if (!player_id || !game_id) {
					showResult('–°–ø–æ—á–∞—Ç–∫—É –∑–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å!')
					return
				}
				fetch(BASE_URL + 'disconnect.php', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ player_id, game_id }),
				})
					.then(r => r.json())
					.then(data => {
						if (data.success) {
							player_id = null
							game_id = null
							showResult('–í—ñ–¥–∫–ª—é—á–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!')
						} else {
							showResult(data.message || '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è')
						}
					})
					.catch(e => showResult('–ü–æ–º–∏–ª–∫–∞: ' + e))
			}

			function cleanup() {
				if (
					!confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è?")
				) {
					return
				}
				fetch(BASE_URL + 'cleanup.php')
					.then(r => r.json())
					.then(data => {
						if (data.success) {
							player_id = null
							game_id = null
							showResult(
								'–û—á–∏—â–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ!\n' +
									'–í—ñ–¥–∫–ª—é—á–µ–Ω–æ –≥—Ä–∞–≤—Ü—ñ–≤: ' +
									data.details.disconnected_players +
									'\n' +
									'–í–∏–¥–∞–ª–µ–Ω–æ —ñ–≥–æ—Ä: ' +
									data.details.deleted_games +
									'\n' +
									'–í–∏–¥–∞–ª–µ–Ω–æ —Ö–æ–¥—ñ–≤: ' +
									data.details.deleted_moves
							)
						} else {
							showResult(data.message || '–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è')
						}
					})
					.catch(e => showResult('–ü–æ–º–∏–ª–∫–∞: ' + e))
			}
		</script>
	</body>
</html>
